# Микросервисы против монолитной архитектуры

### Когда монолиты становятся слишком большими, возможно, пришло время перейти на микросервисы

![Чендлер Харрис Выстрелил в голову](https://wac-cdn.atlassian.com/dam/jcr:2e007186-be8c-45fc-a2a6-8144e2838724/chandler-harris.png?cdnVersion=1520)

##### ЧЕНДЛЕР ХАРРИС

Маркетинговый стратег и писатель

---

Монолитное приложение создается как единое целое, в то время как архитектура микросервисов представляет собой набор небольших независимо развертываемых сервисов. Какой из них подходит именно вам? Это зависит от ряда факторов.

В 2009 году Netflix столкнулся с проблемами роста. Его инфраструктура не могла соответствовать спросу на быстро растущие сервисы потокового видео. Компания решила перенести свою ИТ-инфраструктуру из частных центров обработки данных в общедоступное облако и заменить монолитную архитектуру архитектурой микросервисов. Единственная проблема заключалась в том, что термина “микросервисы” не существовало, а структура не была хорошо известна.

Netflix стала одной из первых крупных компаний, успешно перешедших с монолитной архитектуры микросервисов на облачную. Он получил [Специальную премию жюри JAX 2015 года](https://jaxenter.com/jax-awards-2015) отчасти благодаря этой новой инфраструктуре, которая внедрила DevOps. Сегодня Netflix располагает более чем тысячей микросервисов, которые управляют и поддерживают отдельные части платформы, в то время как ее инженеры часто, иногда тысячи раз в день, развертывают код.

Netflix была пионером в том, что сегодня становится все более распространенным: переходе от монолитной архитектуры к архитектуре микросервисов.

## Что такое монолитная архитектура?

---

Монолитная архитектура - это традиционная модель программного обеспечения, которое построено как единое целое, автономное и независимое от других приложений. Слово “монолит” часто приписывают чему-то большому и незамысловатому, что недалеко от истины в отношении монолитной архитектуры для проектирования программного обеспечения. Монолитная архитектура - это отдельная большая вычислительная сеть с единой кодовой базой, которая объединяет все бизнес-задачи. Чтобы внести изменения в приложения такого типа, требуется обновить весь стек путем доступа к базе кода, а также создания и развертывания обновленной версии интерфейса на стороне службы. Это делает обновления ограничительными и отнимающими много времени.

Монолиты могут быть удобны на ранних этапах существования проекта из-за простоты управления кодом, когнитивных издержек и развертывания. Это позволяет выпускать все в monolith одновременно.

![изображение монолитной архитектуры](https://wac-cdn.atlassian.com/dam/jcr:95b9a276-c524-42b1-8d06-ded56d589858/Monolithic%20architecture@2x.png?cdnVersion=1520)

![значок сборки кода](https://wac-cdn.atlassian.com/dam/jcr:176e0173-f3d2-4031-8a05-8c477bfcf6f2/icons-code-build-dark.svg?cdnVersion=1520)

###### МАТЕРИАЛЫ ПО ТЕМЕ

#### Как создавать микросервисы

[Подробнее](https://www.atlassian.com/ru/microservices/microservices-architecture/building-microservices)

![Значок с тремя кольцами](https://wac-cdn.atlassian.com/dam/jcr:51e8d290-3a37-4514-a835-77cb8b7c0f31/icons-organize-simplify-dark.svg?cdnVersion=1520)

###### ПОСМОТРЕТЬ РЕШЕНИЕ

#### Управляйте своими компонентами с помощью Compass

[Подробнее](https://www.atlassian.com/ru/software/compass)

## Преимущества монолитной архитектуры

---

Организации могут извлечь выгоду как из монолитной, так и из микросервисной архитектуры, в зависимости от ряда различных факторов. При разработке с использованием монолитной архитектуры основным преимуществом является высокая скорость разработки из-за простоты использования приложения, основанного на одной кодовой базе.

Преимущества монолитной архитектуры включают:

**Простое развертывание** – один исполняемый файл или каталог упрощает развертывание.

**Разработка** – Когда приложение создается с использованием одной кодовой базы, его легче разрабатывать.

**Производительность** – В централизованной базе кода и репозитории один API часто может выполнять ту же функцию, которую множество API выполняют с микросервисами.

**Упрощенное тестирование** – Поскольку монолитное приложение представляет собой единый централизованный модуль, сквозное тестирование может выполняться быстрее, чем при использовании распределенного приложения.  
  
**Простая отладка** – когда весь код находится в одном месте, легче отслеживать запрос и находить проблему.

## Недостатки монолитной архитектуры

---

Как и в случае с Netflix, монолитные приложения могут быть довольно эффективными до тех пор, пока они не станут слишком большими и масштабирование не станет проблемой. Внесение небольшого изменения в одну функцию требует компиляции и тестирования всей платформы, что противоречит гибкому подходу, который предпочитают современные разработчики.

К недостаткам монолита относятся:

**Более низкая скорость разработки** – Большое монолитное приложение делает разработку более сложной и медленной.

**Масштабируемость** – вы не можете масштабировать отдельные компоненты.

**Надежность** – ошибка в каком-либо модуле может повлиять на доступность всего приложения.

**Препятствие на пути внедрения технологии** – Любые изменения в фреймворке или языке влияют на все приложение, часто делая изменения дорогостоящими и отнимающими много времени.

**Отсутствие гибкости** – Монолит ограничен технологиями, уже используемыми в monolith.

**Развертывание** – Небольшое изменение в монолитном приложении требует повторного развертывания всего монолита.

## Что такое микросервисы?

---

Архитектура микросервисов, также известная просто как микросервисы, представляет собой архитектурный метод, основанный на серии независимо развертываемых сервисов. Эти сервисы имеют свою собственную бизнес-логику и базу данных с определенной целью. Обновление, тестирование, развертывание и масштабирование происходят внутри каждой службы. Микросервисы разделяют основные бизнес-задачи, относящиеся к конкретной предметной области, на отдельные независимые базы кода. Микросервисы не снижают сложность, но они делают любую сложность видимой и более управляемой, разделяя задачи на более мелкие процессы, которые функционируют независимо друг от друга и вносят вклад в общее целое.  
  
Внедрение микросервисов часто идет рука об руку с DevOps, поскольку они являются основой для практик [непрерывной доставки](https://www.atlassian.com/ru/continuous-delivery), которые позволяют командам быстро адаптироваться к требованиям пользователей.

![изображение микросервисной архитектуры](https://wac-cdn.atlassian.com/dam/jcr:5308ccab-dc94-46f5-978c-8a77b8d5be57/Microservice%20architecture@2x.png?cdnVersion=1520)

## Путь Atlassian к микросервисам

---

Atlassian пошла по пути создания микросервисов в 2018 году после того, как мы столкнулись с проблемами роста и масштабирования благодаря Jira и Confluence. Мы обнаружили, что наши однопользовательские монолитные архитектуры, работающие локально, не смогут масштабироваться в соответствии с будущими потребностями.

Мы решили перепроектировать Jira и Confluence и перевести их из однопользовательской монолитной системы с отслеживанием состояния в многопользовательские облачные приложения без состояния, размещенные на Amazon Web Services (AWS). Затем мы со временем разложили бы их на микросервисы. Проект получил название Vertigo, в честь того, что старший инженер сказал: “Мне действительно нравится идея, но у меня от нее кружится голова”. Это был наш крупнейший инфраструктурный проект на сегодняшний день, на завершение перехода на AWS потребовалось два года, в результате чего более 100 000 клиентов были переведены всего за 10 месяцев без перебоев в обслуживании. Мы также взяли на себя обязательство разложить сервисы на микросервисы.

## Преимущества микросервисов

---

Микросервисы ни в коем случае не являются "серебряной пулей", но они решают ряд проблем для растущего программного обеспечения и компаний. Поскольку архитектура микросервисов состоит из модулей, работающих независимо, каждую службу можно разрабатывать, обновлять, развертывать и масштабировать, не затрагивая другие службы. Обновления программного обеспечения могут выполняться чаще, что повышает надежность, время безотказной работы и производительность. Мы перешли от отправки обновлений раз в неделю к двум-трем разам в день.

По мере роста Atlassian микросервисы позволяют нам более надежно масштабировать команды и географические местоположения за счет разделения по линиям владения услугами. До того, как мы основали Vertigo, у Atlassian было пять различных центров разработки по всему миру. Эти распределенные команды были ограничены централизованным монолитом, и нам нужно было поддерживать их автономно. Микросервисы позволяют нам это делать.

Преимущества Vertigo включают в себя повышенную скорость развертывания, аварийное восстановление, снижение затрат и повышение производительности. Это позволяет нам быстрее достигать нашей цели, одновременно принося больше дополнительной пользы заказчикам.

Плюс, в более общем плане, микросервисы упрощают командам обновление кода и ускоряют циклы выпуска благодаря [непрерывной интеграции и непрерывной доставке (CI / CD)](https://www.atlassian.com/ru/continuous-delivery). Команды могут экспериментировать с кодом и выполнять откат, если что-то пойдет не так.

Короче говоря, преимущества микросервисов заключаются в следующем:

**Гибкость** – Продвигайте гибкие способы работы с небольшими командами, которые часто внедряются.

**Гибкое масштабирование** – если микросервис достигает своей допустимой нагрузки, новые экземпляры этого сервиса могут быть быстро развернуты в сопутствующем кластере, чтобы облегчить нагрузку. Теперь мы работаем с несколькими арендаторами и без состояния, а клиенты распределены по нескольким инстансам. Теперь мы можем поддерживать инстансы гораздо большего размера.

**Непрерывное развертывание** – теперь у нас частые и более быстрые циклы выпуска. Раньше мы выпускали обновления раз в неделю, а теперь можем делать это примерно два-три раза в день.

**Высокая ремонтопригодность и тестируемость** – команды могут экспериментировать с новыми функциями и выполнять откат, если что-то не работает. Это упрощает обновление кода и ускоряет вывод на рынок новых функций. Кроме того, легко изолировать и исправлять ошибки в отдельных сервисах.

**Независимо развертываемые** – поскольку микросервисы представляют собой отдельные модули, они обеспечивают быстрое и простое независимое развертывание отдельных функций.

**Технологическая гибкость** – Микросервисные архитектуры предоставляют командам свободу выбора необходимых инструментов.

**Высокая надежность** – вы можете внедрять изменения для конкретной службы без угрозы сбоя всего приложения.  
  
**Более счастливые команды** – Команды Atlassian, работающие с микросервисами, намного счастливее, поскольку они более автономны и могут создавать и развертывать самостоятельно, не ожидая неделями утверждения запроса на извлечение.

## Недостатки микросервисов

---

Когда мы перешли от небольшого числа монолитных кодовых баз ко множеству более распределенных систем и сервисов, поддерживающих наши продукты, возникла непредвиденная сложность. Изначально мы пытались добавлять новые возможности с той же скоростью и уверенностью, что и в прошлом. Микросервисы могут усложнять процесс разработки, что приводит к разрастанию разработки или быстрому и неуправляемому росту. Определить, как различные компоненты связаны друг с другом, кому принадлежит конкретный программный компонент или как избежать вмешательства в работу зависимых компонентов, может быть непросто.

С помощью Vertigo мы создали общую функциональность, которая будет использоваться в наших существующих продуктах и будущих продуктах, которые мы приобретаем и создаем. Если вы занимаетесь производством одного продукта, микросервисы могут и не понадобиться.

К недостаткам микросервисов можно отнести:

**Разрастание разработки** – Микросервисы усложняют работу по сравнению с монолитной архитектурой, поскольку в большем количестве мест создается больше сервисов несколькими командами. Если не управлять разрастанием разработки должным образом, это приводит к снижению скорости разработки и производительности.

**Экспоненциальные затраты на инфраструктуру** – У каждого нового микросервиса могут быть свои затраты на набор тестов, учебные пособия по развертыванию, инфраструктуру хостинга, инструменты мониторинга и многое другое.

**Дополнительные организационные издержки** – командам необходимо повысить уровень коммуникации и совместной работы для координации обновлений и интерфейсов.

**Проблемы с отладкой** – Каждый микросервис имеет свой собственный набор журналов, что усложняет отладку. Кроме того, один бизнес-процесс может выполняться на нескольких компьютерах, что еще больше усложняет отладку.

**Отсутствие стандартизации** – Без общей платформы может произойти распространение языков, стандартов ведения журнала и мониторинга.

**Отсутствие четкого права собственности** – По мере появления новых сервисов увеличивается и количество команд, работающих с этими сервисами. Со временем становится трудно определить, какие доступные сервисы может использовать команда и к кому обратиться за поддержкой.

![изображение monolith vs microservices](https://wac-cdn.atlassian.com/dam/jcr:b2be0d53-f4b2-46d8-9a34-993048cc6225/Monolith%20Vs%20Microservice%20image.png?cdnVersion=1520)

## Советы Atlassian по переходу с монолитной архитектуры на микросервисную

---

Многие проекты изначально начинаются как монолит, а затем развиваются в микросервисную архитектуру. По мере добавления новых функций в монолит, привлечение большого количества разработчиков, работающих над единой кодовой базой, может стать обременительным. Конфликты кода становятся более частыми, и возрастает риск того, что обновления одной функции приведут к ошибкам в несвязанной функции. Когда возникают эти нежелательные шаблоны, возможно, пришло время рассмотреть возможность перехода на микросервисы.

Ниже приведены некоторые из лучших практик, которые мы извлекли из нашей миграции:

### Наметьте стратегию миграции

Мы потратили значительное количество времени на определение последовательности переноса клиентов. Мы знали, что у многих наших клиентов после переноса будут другие профили и иная динамика использования, поэтому заранее спланировали все соответствующим образом.

### Инструментарий

Правильные инструменты необходимы при миграции микросервисов. Мы не сразу переносили клиентов, а сначала инвестировали и создали инструменты для миграции, зная, что это марафон, а не спринт. Самым важным инструментом, который мы создали, был Microscope, наш собственный внутренний каталог сервисов для отслеживания всех микросервисов. Каждый разработчик Atlassian может использовать Microscope для просмотра всей информации о любом микросервисе в компании.

Мы также встроили в Microscope инструмент ServiceQuest, который автоматически обнаруживает проверки кода перед производством, включая проверки качества, дизайна сервиса, конфиденциальности, безопасности и надежности.

Кроме того, инструмент был построен на основе наших технологических стеков. У нас внутри есть служба, которая позволяет нам запускать новую службу в определенном стеке, и она предшествует таким вещам, как ведение журнала, мониторинг и кэширование. Наконец, мы автоматизировали все, что могли, включая сам процесс миграции. Мы создали собственную панель мониторинга, позволяющую эффективно просматривать все миграции в режиме реального времени.

### Управление ожиданиями

Для трансформации компании требуется старший исполнительный спонсор, который несет ответственность за результаты и готов добиваться необходимых компромиссов, [сказал Шри Вишванат](https://www.atlassian.com/engineering/five-alarm-fire), технический директор Atlassian. Этот сотрудник должен позволить организации инвестировать в новые инструменты, системы и процессы, чтобы сделать улучшения постоянными.  
  
При масштабной миграции инфраструктуры, в которой задействовано много людей, бизнес хочет знать о возврате инвестиций, [сказал Майк Триа](http://www.devnetwork.com/videos/developerweek-global-2020/atlassians-journey-from-monolith-to-microservices/), руководитель платформы Atlassian. Очень важно поддерживать связь с руководством, заинтересованными сторонами, заказчиками, партнерами и остальными научно-исследовательскими группами. Убедитесь, что они знают, что вы делаете, включая ожидаемые выгоды. Кроме того, обязательно отмечайте успехи.

### Примите изменения в культуре

"Культура имеет большое значение в таких масштабных проектах", - [сказал Вишванат](http://www.zdnet.com/article/atlassians-largest-ever-infrastructure-project-cto-shares-lessons-learned/). "При возникновении проблемы нужно быть уверенным, что она возникает каждый раз". Когда вы выполняете миграцию, это не просто техническая миграция, но кадровые и организационные изменения. В 2015 году Atlassian предлагал “написать код и перебросить его через стену” операционной команде, которая запускала и развертывала его. К концу 2017 года мы приняли [культуру DevOps](https://www.atlassian.com/ru/devops/what-is-devops/devops-culture) по принципу “вы создаете это, вы запускаете это”, когда каждый разработчик в Atlassian запускает свои собственные сервисы.

“Я потратил больше времени на то, чтобы убедиться, что наша команда SRE добилась успеха в этом проекте, чем почти на любую другую работу, которую я выполнял в ходе проекта, потому что культурный сдвиг был самым большим долгосрочным изменением для Atlassian в результате Vertigo”, - сказал Триа.

### Баланс скорости и доверия

Vertigo можно было выполнить намного быстрее. За первые четыре месяца мы выполнили 80 процентов миграций. Мы могли бы перенести последнюю часть пользователей, хотя и не могли гарантировать, что они будут обладать той надежностью и производительностью, которые мы хотели. Мы придерживаемся одной из основных ценностей Atlassian: не #@!% клиент.

Мы установили систему сдержек и противовесов с нашими инженерами для поддержания высокой надежности и соответствовали высоким стандартам, которых намеревались достичь. Потому что, если вы соберете все правильно с первого раза, вы сэкономите время и головную боль в долгосрочной перспективе.

Когда мы добрались до последних 500 клиентов, которые были самыми сложными для миграции, мы использовали программное обеспечение Jira и интеграцию Trello, чтобы назначить каждого клиента инженеру Atlassian.

## Вкратце...

---

В январе 2016 года у нас было всего около 15 микросервисов. Сейчас у нас более 1300. Мы перевели 100 тыс. клиентов в облако, попутно построили новую платформу, изменили нашу культуру и в итоге получили новые инструменты. У нас более счастливые, автономные команды и лучшая культура DevOps.

Микросервисы могут быть не для всех. Устаревший монолит может работать идеально, и его разборка может не стоить усилий. Но по мере роста организаций и повышения требований к их приложениям архитектура микросервисов может оказаться полезной.  
  
Поскольку для многих организаций трендом являются микросервисы с распределенной архитектурой, Atlassian разработала [Compass](https://www.atlassian.com/ru/software/compass), чтобы помочь компаниям управлять сложностью распределенных архитектур по мере их масштабирования. Это расширяемая платформа взаимодействия с разработчиками, которая объединяет разрозненную информацию обо всех инженерных разработках и совместной работе команды в центральном месте с возможностью поиска.

[Узнайте больше о Compass](https://www.atlassian.com/ru/software/compass)

![Чендлер Харрис](https://wac-cdn.atlassian.com/ru/dam/jcr:2e007186-be8c-45fc-a2a6-8144e2838724/chandler-harris.png?cdnVersion=1520)

ЧЕНДЛЕР ХАРРИС

Чендлер Харрис — специалист по маркетинговым стратегиям и писатель для Atlassian. Он написал более 40 публикаций на различные темы, такие как технологии, наука, бизнес, финансы и образование.